COMNETX CONTAINER (create_from_image.sh)
Контейнер на основе публичного образа diaduskaau/comnetx, запуск на новом сервере через скрипт create_from_image.sh. Скрипт создаёт и стартует контейнер, позволяет задать размер shared memory, при необходимости пересоздаёт контейнер, а также (по запросу) может сохранить изменения обратно в образ и запушить их.

Требования
Docker установлен и запущен. Проверка: docker --version.​

Для использования GPU: установлен NVIDIA Container Toolkit, видна команда nvidia-smi на хосте.​

Доступ к публичному образу diaduskaau/comnetx:latest (репозиторий должен быть Public; pull без логина возможен).​

Наличие каталогов, которые монтируются в контейнер (по умолчанию в скрипте):

/auto/datasets/graphs

/home/$USER

Быстрый старт
Склонировать/скопировать скрипт

Скопируйте create_from_image.sh на сервер и сделайте его исполняемым:

chmod +x ./create_from_image.sh.​

Запуск контейнера

Базовый запуск с именем и увеличенным shm-size:

./create_from_image.sh -n myproj -m 16g.​

Если контейнер с таким именем уже существует, пересоздать:

./create_from_image.sh -n myproj -m 16g -r.​

Вход в контейнер

Скрипт сам выполнит интерактивный вход (docker exec -it NAME /bin/bash), после выхода контейнер останется запущенным, если не завершить процесс внутри.​

Параметры скрипта
-n NAME — имя проекта; реальное имя контейнера будет ${USER}_NAME, например drobyshev_myproj.​

-m SHM_SIZE — размер shared memory (/dev/shm), по умолчанию 2g; рекомендуемые значения:

Один gpu 8–16 ГБ: 8g достаточно для DataLoader с несколькими воркерами.​

Несколько gpu (DDP, большие батчи): 16g или 32g для устойчивой работы.​

-r — пересоздаёт контейнер, если существует одноимённый.​

-h — помощь.​

Пример:

./create_from_image.sh -n research -m 32g -r.​

Проверка GPU внутри контейнера
После старта:

nvidia-smi — видимость GPU.​

python -c "import torch; print(torch.cuda.is_available())" — проверка PyTorch CUDA.​

Если GPU не виден:

Убедитесь, что Docker запущен с поддержкой GPU (NVIDIA Toolkit установлен), и сервер имеет доступные устройства.​​​

Директории:
По умолчанию в create_from_image.sh:

-v /auto/datasets/graphs:/auto/datasets/graphs — общий датасет.​

-v /home/$USER:/home/$USER — домашняя директория пользователя.​

Если на новом сервере этих путей нет, уберите или замените их на существующие, иначе docker create завершится ошибкой о несуществующем пути.​

Несколько контейнеров для разных пользователей
Запускайте скрипт под каждым пользователем отдельно с уникальным -n, чтобы получить разные имена контейнеров (${USER}_suffix) и монтировать соответствующие /home/<user>.​

Для раздачи GPU по контейнерам можно использовать --gpus с маской устройств (при необходимости — добавьте параметр в скрипт).​


Полезные команды
Проверить локальные контейнеры: docker ps -a.​

Логи контейнера: docker logs <name> | tail -n 100 ​.

Войти внутрь: docker exec -it <name> bash.​

Остановить/удалить: docker stop <name> && docker rm <name>